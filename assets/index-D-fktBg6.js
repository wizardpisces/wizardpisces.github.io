import{_ as L,r as x,o as u,c as d,F as N,d as G,n as X,a as c,t as y,e as q,f as g,g as O,h as R,i as J,j as _,k as Y,w as Z,l as $,v as A,b as B,m as ee,p as te,q as oe,s as ne,x as se}from"./index-CGHDFhbw.js";const re={name:"TreeFolderSubHeaders",props:{headers:{type:Array}},setup(e){let{activeSubHeader:n,setActiveSubHeader:a}=O();function t(o){a(o)}return{onSubHeaderClick:t,activeSubHeader:n}}},ae={class:"tree-folder-sub-headers"},ce=["href","onClick"];function ie(e,n,a,t,o,r){const s=x("tree-folder-sub-headers",!0);return u(),d("ul",ae,[(u(!0),d(N,null,G(a.headers,(i,l)=>(u(),d("li",{key:l,class:X({"tree-folder-sub-header":!0,active:t.activeSubHeader.title===i.title})},[c("a",{href:i.link,class:"sidebar-link",onClick:m=>t.onSubHeaderClick(i)},y(i.title),9,ce),i.children?(u(),q(s,{key:0,headers:i.children},null,8,["headers"])):g("",!0)],2))),128))])}const le=L(re,[["render",ie]]),ue={name:"RightToc",components:{TreeFolderSubHeaders:le},props:{headers:{type:Array,default:()=>[]}}},he={key:0,class:"right-toc"},de=c("div",{class:"toc-header"},"ç›®å½•",-1),me={class:"toc-content"};function ge(e,n,a,t,o,r){const s=x("tree-folder-sub-headers");return a.headers&&a.headers.length?(u(),d("aside",he,[de,c("div",me,[R(s,{headers:a.headers},null,8,["headers"])])])):g("",!0)}const _e=L(ue,[["render",ge]]);let S=null,C=null,I=null;async function F(){if(S)return S;try{const e=await fetch("/blog-embeddings-bge.json");if(!e.ok)throw new Error(`Failed to load embeddings: ${e.status}`);return S=await e.json(),console.log(`âœ… å·²åŠ è½½ ${S.length} ä¸ªæ®µè½åµŒå…¥å‘é‡`),S}catch(e){throw console.error("âŒ åŠ è½½åµŒå…¥å‘é‡å¤±è´¥:",e),e}}async function H(){if(C)return C;try{const e=await fetch("/blog-chunks.json");if(!e.ok)throw new Error(`Failed to load chunks: ${e.status}`);return C=await e.json(),console.log(`âœ… å·²åŠ è½½ ${C.length} ä¸ªæ–‡æ¡£æ®µè½`),C}catch(e){throw console.error("âŒ åŠ è½½åˆ†æ®µæ•°æ®å¤±è´¥:",e),e}}async function K(){if(I)return I;try{console.log("ğŸ¤– æ­£åœ¨åŠ è½½ BGE ä¸­æ–‡åµŒå…¥æ¨¡å‹...");const{pipeline:e}=await J(async()=>{const{pipeline:n}=await import("./transformers.web-Ng3if5QZ.js");return{pipeline:n}},[]);return I=await e("feature-extraction","Xenova/bge-small-zh-v1.5",{progress_callback:n=>{n.status==="downloading"&&console.log(`ğŸ“¥ ä¸‹è½½æ¨¡å‹: ${n.name} - ${Math.round(n.progress||0)}%`)}}),console.log("âœ… BGE åµŒå…¥æ¨¡å‹åŠ è½½å®Œæˆ"),I}catch(e){throw console.error("âŒ åŠ è½½åµŒå…¥æ¨¡å‹å¤±è´¥:",e),e}}function ye(e,n){if(!e||!n||e.length!==n.length)return 0;let a=0,t=0,o=0;for(let r=0;r<e.length;r++)a+=e[r]*n[r],t+=e[r]*e[r],o+=n[r]*n[r];return t===0||o===0?0:a/(Math.sqrt(t)*Math.sqrt(o))}async function fe(e){try{const a=await(await K())(e,{pooling:"mean",normalize:!0}),t=Array.from(a.data);return console.log(`ğŸ¯ ä¸ºæŸ¥è¯¢ç”Ÿæˆäº† ${t.length} ç»´è¯­ä¹‰å‘é‡`),t}catch(n){throw console.error("âŒ ç”ŸæˆæŸ¥è¯¢åµŒå…¥å‘é‡å¤±è´¥:",n),n}}async function we(e,n=15){console.log(`ğŸ” åˆ†æ®µæœç´¢: "${e}"`);const a=await fe(e),t=await F(),o=await H(),r=[];for(const s of t){const i=ye(a,s.embedding);if(i>.1){const l=o.find(m=>m.chunkId===s.chunkId);if(l){const m=l.content.toLowerCase(),M=e.toLowerCase(),Q=m.includes(M);r.push({chunkId:l.chunkId,url:l.url,title:l.title,originalTitle:l.originalTitle,content:l.content,chunkIndex:l.chunkIndex,totalChunks:l.totalChunks,similarity:i,containsQuery:Q,startPos:l.startPos,endPos:l.endPos})}}}return r.sort((s,i)=>i.similarity-s.similarity),console.log(`ğŸ“„ æ‰¾åˆ° ${r.length} ä¸ªç›¸å…³æ®µè½`),r.slice(0,n)}function ke(e,n=5){const a=new Map;for(const o of e){a.has(o.url)||a.set(o.url,{url:o.url,title:o.originalTitle,chunks:[],maxSimilarity:0,avgSimilarity:0,containsQuery:!1,totalChunks:o.totalChunks});const r=a.get(o.url);r.chunks.push(o),r.maxSimilarity=Math.max(r.maxSimilarity,o.similarity),r.containsQuery=r.containsQuery||o.containsQuery}const t=Array.from(a.values()).map(o=>{o.avgSimilarity=o.chunks.reduce((l,m)=>l+m.similarity,0)/o.chunks.length;const r=o.chunks[0];let s=r.content;s.length>350&&(s=s.substring(0,350)+"...");const i=o.maxSimilarity*.7+o.avgSimilarity*.3;return{title:o.title,url:o.url,snippet:s,score:i,containsQuery:o.containsQuery,semanticScore:o.maxSimilarity,avgSimilarity:o.avgSimilarity,matchedChunks:o.chunks.length,totalChunks:o.totalChunks,bestChunk:{index:r.chunkIndex,similarity:r.similarity,content:r.content}}});return t.sort((o,r)=>{if(Math.abs(o.score-r.score)<.03){if(o.containsQuery&&!r.containsQuery)return-1;if(!o.containsQuery&&r.containsQuery)return 1}return r.score-o.score}),t.slice(0,n)}async function ve(e,n=5){if(!e||typeof e!="string")return[];try{console.log(`ğŸš€ å¼€å§‹åˆ†æ®µè¯­ä¹‰æœç´¢: "${e}"`);const a=await we(e,n*3);if(a.length===0)return console.log("âš ï¸ æœªæ‰¾åˆ°ç›¸å…³æ®µè½"),[];const t=ke(a,n);return console.log(`âœ… åˆ†æ®µè¯­ä¹‰æœç´¢å®Œæˆï¼Œè¿”å› ${t.length} ä¸ªç»“æœ`),t.length>0&&(console.log("ğŸ¯ åˆ†æ®µæœç´¢ç»“æœæ’åº:"),t.forEach((o,r)=>{console.log(`  ${r+1}. ${o.title}`),console.log(`     - ç»¼åˆåˆ†æ•°: ${(o.score*100).toFixed(1)}%`),console.log(`     - æœ€é«˜ç›¸ä¼¼åº¦: ${(o.semanticScore*100).toFixed(1)}%`),console.log(`     - åŒ¹é…æ®µè½: ${o.matchedChunks}/${o.totalChunks}`),console.log(`     - åŒ…å«å…³é”®è¯: ${o.containsQuery?"æ˜¯":"å¦"}`)})),t}catch(a){return console.error("âŒ åˆ†æ®µè¯­ä¹‰æœç´¢å¤±è´¥:",a),[]}}async function pe(){try{await F(),await H();const e=K(),n=new Promise(a=>setTimeout(()=>a(!0),2e3));return await Promise.race([e,n]),!0}catch(e){return console.error("âŒ è¯­ä¹‰æœç´¢ä¸å¯ç”¨:",e),!1}}async function be(){try{return console.log("ğŸ”¥ å¼€å§‹é¢„çƒ­åˆ†æ®µè¯­ä¹‰æœç´¢..."),await F(),await H(),await K(),console.log("âœ… åˆ†æ®µè¯­ä¹‰æœç´¢é¢„çƒ­å®Œæˆ"),!0}catch(e){return console.error("âŒ åˆ†æ®µè¯­ä¹‰æœç´¢é¢„çƒ­å¤±è´¥:",e),!1}}const Se={name:"BlogSearch",setup(){const e=_(""),n=_([]),a=_("semantic"),t=_(!1),o=_(!1),r=_(!0),s=_(!1),i=_(""),l=_(!1),m=_(""),M=async(h,f=10)=>{try{const W=await(await fetch("/blog-content.json")).json(),v=h.toLowerCase(),V=[];for(const p of W){const E=p.title||"",w=p.content||"",j=E.toLowerCase(),P=w.toLowerCase();if(j.includes(v)||P.includes(v)){let b=w.length>200?w.substring(0,200)+"...":w;if(P.includes(v)){const z=P.indexOf(v),D=Math.max(0,z-100),U=Math.min(w.length,z+h.length+100);b=w.substring(D,U).trim(),D>0&&(b="..."+b),U<w.length&&(b+="...")}V.push({title:E,url:p.url,snippet:b,containsQuery:!0,score:j.includes(v)?.9:.7})}}return V.sort((p,E)=>E.score-p.score).slice(0,f)}catch(T){return console.error("âŒ å…³é”®è¯æœç´¢å¤±è´¥:",T),[]}};Y(async()=>{try{const h=await pe();if(s.value=h,h){console.log("âœ… è¯­ä¹‰æœç´¢å¯ç”¨"),l.value=!0,m.value="æ­£åœ¨åŠ è½½åˆ†æ®µè¯­ä¹‰æœç´¢æ¨¡å‹...";try{await be(),m.value="åˆ†æ®µè¯­ä¹‰æœç´¢å·²å‡†å¤‡å°±ç»ªï¼",console.log("ğŸ”¥ è¯­ä¹‰æœç´¢é¢„çƒ­å®Œæˆ"),setTimeout(()=>{l.value=!1,m.value=""},1500)}catch(f){console.warn("âš ï¸ è¯­ä¹‰æœç´¢é¢„çƒ­å¤±è´¥ï¼Œä½†ä»å¯ä½¿ç”¨:",f),l.value=!1,m.value=""}}else console.log("âš ï¸ è¯­ä¹‰æœç´¢ä¸å¯ç”¨ï¼Œä½¿ç”¨å…³é”®è¯æœç´¢"),a.value="keyword";r.value=!1}catch(h){console.error("âŒ æœç´¢å¼•æ“åˆå§‹åŒ–å¤±è´¥:",h),i.value="æœç´¢å¼•æ“åˆå§‹åŒ–å¤±è´¥",a.value="keyword",r.value=!1}}),Z(a,h=>{h==="semantic"&&!s.value?(a.value="keyword",i.value="è¯­ä¹‰æœç´¢ä¸å¯ç”¨ï¼Œå·²åˆ‡æ¢åˆ°å…³é”®è¯æœç´¢"):i.value=""});const Q=async()=>{if(e.value.trim()){t.value=!0,o.value=!0,i.value="";try{let h=[];if(a.value==="semantic"){console.log(`ğŸ§  ä½¿ç”¨è¯­ä¹‰æœç´¢: "${e.value}"`);try{h=await ve(e.value,10)}catch(f){console.error("âŒ è¯­ä¹‰æœç´¢å¤±è´¥ï¼Œå›é€€åˆ°å…³é”®è¯æœç´¢:",f),i.value="è¯­ä¹‰æœç´¢å¤±è´¥ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°å…³é”®è¯æœç´¢",h=await M(e.value,10)}}else console.log(`ğŸ” ä½¿ç”¨å…³é”®è¯æœç´¢: "${e.value}"`),h=await M(e.value,10);n.value=h,console.log(`âœ… æœç´¢å®Œæˆï¼Œè¿”å› ${h.length} ä¸ªç»“æœ`)}catch(h){console.error("âŒ æœç´¢å¤±è´¥:",h),i.value="æœç´¢å¤±è´¥ï¼Œè¯·é‡è¯•",n.value=[]}finally{t.value=!1}}};return{searchQuery:e,searchResults:n,searchMode:a,isLoading:t,hasSearched:o,isInitializing:r,semanticAvailable:s,error:i,isWarmingUp:l,warmupProgress:m,handleSearch:Q,switchToKeywordSearch:()=>{a.value="keyword",i.value="",e.value.trim()&&Q()},highlightQuery:h=>{if(!e.value.trim())return h;const f=e.value.trim(),T=new RegExp(`(${f})`,"gi");return h.replace(T,"<mark>$1</mark>")}}}},k=e=>(oe("data-v-57ebf186"),e=e(),ne(),e),Ce={class:"blog-search"},xe={class:"search-container"},Me={class:"search-mode-selector"},Qe={class:"search-input-container"},Te=["disabled"],Ee={key:0,class:"warmup-notice"},Ie=k(()=>c("div",{class:"warmup-spinner"},null,-1)),Re={key:1,class:"search-notice search-notice-semantic"},Le=k(()=>c("p",null,"ğŸ§  ä½¿ç”¨åˆ†æ®µè¯­ä¹‰æœç´¢æ¨¡å¼",-1)),Pe=k(()=>c("p",{class:"search-tip"},"åŸºäº BGE ä¸­æ–‡æ¨¡å‹çš„åˆ†æ®µå‘é‡ç›¸ä¼¼åº¦ï¼Œç²¾å‡†åŒ¹é…æ–‡æ¡£æ®µè½å†…å®¹",-1)),$e=[Le,Pe],Be={key:2,class:"search-notice"},Fe=k(()=>c("p",null,"ğŸ” ä½¿ç”¨å…³é”®è¯æœç´¢æ¨¡å¼",-1)),He=k(()=>c("p",{class:"search-tip"},"åŸºäºå…³é”®è¯åŒ¹é…ï¼ŒæŸ¥æ‰¾åŒ…å«æœç´¢è¯çš„å†…å®¹",-1)),Ke=[Fe,He],Ve={key:3,class:"search-results"},je={class:"results-header"},ze=["href"],De={key:0,class:"match-tag"},Ue={key:1,class:"score-tag"},Ae={key:2,class:"chunk-tag"},Ne=["innerHTML"],Ge={key:4,class:"no-results"},Oe={key:0,class:"search-tip"},We={key:5,class:"initializing"},Xe=k(()=>c("p",null,"ğŸš€ æ­£åœ¨åˆå§‹åŒ–æœç´¢å¼•æ“...",-1)),qe=[Xe],Je={key:6,class:"error-message"};function Ye(e,n,a,t,o,r){return u(),d("div",Ce,[c("div",xe,[c("div",Me,[c("label",null,[$(c("input",{type:"radio","onUpdate:modelValue":n[0]||(n[0]=s=>t.searchMode=s),value:"semantic"},null,512),[[A,t.searchMode]]),B(" è¯­ä¹‰æœç´¢ ")]),c("label",null,[$(c("input",{type:"radio","onUpdate:modelValue":n[1]||(n[1]=s=>t.searchMode=s),value:"keyword"},null,512),[[A,t.searchMode]]),B(" å…³é”®è¯æœç´¢ ")])]),c("div",Qe,[$(c("input",{"onUpdate:modelValue":n[2]||(n[2]=s=>t.searchQuery=s),type:"text",placeholder:"æœç´¢åšå®¢å†…å®¹...",onKeyup:n[3]||(n[3]=te((...s)=>t.handleSearch&&t.handleSearch(...s),["enter"])),class:"search-input"},null,544),[[ee,t.searchQuery]]),c("button",{onClick:n[4]||(n[4]=(...s)=>t.handleSearch&&t.handleSearch(...s)),class:"search-button",disabled:t.isLoading},y(t.isLoading?"æœç´¢ä¸­...":"æœç´¢"),9,Te)])]),t.isWarmingUp?(u(),d("div",Ee,[c("p",null,"ğŸš€ "+y(t.warmupProgress),1),Ie])):t.searchMode==="semantic"?(u(),d("div",Re,$e)):t.searchMode==="keyword"?(u(),d("div",Be,Ke)):g("",!0),t.searchResults.length>0?(u(),d("div",Ve,[c("div",je,[c("h3",null,"æœç´¢ç»“æœ ("+y(t.searchResults.length)+")",1)]),(u(!0),d(N,null,G(t.searchResults,s=>(u(),d("div",{key:s.url,class:"search-result-item"},[c("h4",null,[c("a",{href:s.url},y(s.title),9,ze),s.containsQuery?(u(),d("span",De,"åŒ…å«åŒ¹é…è¯")):g("",!0),t.searchMode==="semantic"&&s.score?(u(),d("span",Ue," ç›¸ä¼¼åº¦: "+y((s.score*100).toFixed(1))+"% ",1)):g("",!0),t.searchMode==="semantic"&&s.matchedChunks?(u(),d("span",Ae,y(s.matchedChunks)+"/"+y(s.totalChunks)+" æ®µè½åŒ¹é… ",1)):g("",!0)]),s.snippet?(u(),d("p",{key:0,class:"result-content",innerHTML:t.highlightQuery(s.snippet)},null,8,Ne)):g("",!0)]))),128))])):t.hasSearched&&!t.isLoading?(u(),d("div",Ge,[c("p",null,'æœªæ‰¾åˆ°ä¸ "'+y(t.searchQuery)+'" ç›¸å…³çš„å†…å®¹',1),t.searchMode==="semantic"?(u(),d("p",Oe,[B(" å°è¯•ä½¿ç”¨ä¸åŒçš„å…³é”®è¯æˆ–åˆ‡æ¢åˆ°å…³é”®è¯æœç´¢ "),c("button",{onClick:n[5]||(n[5]=(...s)=>t.switchToKeywordSearch&&t.switchToKeywordSearch(...s)),class:"switch-mode-btn"},"åˆ‡æ¢åˆ°å…³é”®è¯æœç´¢")])):g("",!0)])):g("",!0),t.isInitializing?(u(),d("div",We,qe)):g("",!0),t.error?(u(),d("div",Je,[c("p",null,"âŒ "+y(t.error),1),c("button",{onClick:n[6]||(n[6]=(...s)=>t.switchToKeywordSearch&&t.switchToKeywordSearch(...s)),class:"switch-mode-btn"},"åˆ‡æ¢åˆ°å…³é”®è¯æœç´¢")])):g("",!0)])}const Ze=L(Se,[["render",Ye],["__scopeId","data-v-57ebf186"]]),et={name:"Blog",components:{RightToc:_e,BlogSearch:Ze},setup(){const{activeBlog:e}=O();return{activeSubHeaders:se(()=>e.value.subHeaders||[])}}},tt={class:"blog-container"},ot={class:"blog-content"};function nt(e,n,a,t,o,r){const s=x("blog-search"),i=x("router-view"),l=x("right-toc");return u(),d("div",tt,[R(s,{class:"blog-search-component"}),c("div",ot,[R(i)]),R(l,{headers:t.activeSubHeaders},null,8,["headers"])])}const ct=L(et,[["render",nt]]);export{ct as default};
